\documentclass{article}
\usepackage{amsmath}
\usepackage{fancyhdr}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{cite}
\usepackage{float}
\theoremstyle{definition}
\newtheorem{theorem}{Theorem}
\newenvironment{sketchproof}{%
  \renewcommand{\proofname}{Sketch of Proof}\proof}{\endproof}
  
\setlength{\parindent}{0pt}

\usepackage{Sweave}
\begin{document}
\input{recombiningTree-concordance}

\section{}
Consider the SDE \(dX=\alpha(X, t)dt+\sigma(X, t)dW_t\).  Now consider \(f(y)\) such that \(f'(y)=\frac{1}{\sigma(y, t)}\).  Then \[df(X)=\frac{1}{\sigma(X, t)} \alpha(X, t)dt+dW_t-\frac{\sigma^2(X, t)\sigma'(X)dt}{2\sigma^2(X, t)}\]

\[=\left(\frac{\alpha(X, t)}{\sigma(X, t)}-\frac{\sigma'(X)}{2}\right)dt+dW_t\]
 
 This dynamic can lead to a recombining tree.  Letting \(y=f(x)\) then \(u_i=y_0+(m-i)\sqrt{\Delta t}\) and \(d_i=y_0-(m-i)\sqrt{\Delta t}\).  The actual value at each node is given by \(f^{-1}(u_i)\). The probability of the move is solved by \(p*u+(1-p)*d=\left(\frac{\alpha(X, t)}{\sigma(X, t)}-\frac{\sigma'(X)}{2}\right)\Delta t\). 
 
 \[p\sqrt{\Delta t}-(1-p)\sqrt{\Delta t}=\left(\frac{\alpha(X, t)}{\sigma(X, t)}-\frac{\sigma'(X)}{2}\right)\Delta t\]
  \[2p-1=\left(\frac{\alpha(X, t)}{\sigma(X, t)}-\frac{\sigma'(X)}{2}\right)\sqrt{\Delta t}\]
  \[p=\frac{1}{2}\left(\frac{\alpha(X, t)}{\sigma(X, t)}-\frac{\sigma'(X)}{2}\right)\sqrt{\Delta t}+\frac{1}{2}\]
  
  \section{Caplet and Bond option equivalency}
  
  The value of a caplet is 
  
\[\delta\mathbb{\tilde{E}}\left[D(t, T+\delta)\left(\frac{1-B(T, T+\delta)}{\delta B(T, T+\delta)}-k\right)^+ |\mathcal{F}_t\right]\]

\[=\delta\mathbb{\tilde{E}}\left[D(t, T+\delta)\left(\frac{1}{\delta B(T, T+\delta)}-k-\frac{1}{\delta}\right)^+ |\mathcal{F}_t\right]\]
 
\[=\delta\mathbb{\tilde{E}}\left[D(t, T)\left(\frac{ \mathbb{\tilde{E}}[D(T, T+\delta)|\mathcal{F}_T]}{\delta B(T, T+\delta)}-\mathbb{\tilde{E}}[D(T, T+\delta)|\mathcal{F}_T]\left(k+\frac{1}{\delta}\right)\right)^+ |\mathcal{F}_t\right]\]

\[=\delta\mathbb{\tilde{E}}\left[D(t, T)\left(\frac{1}{\delta}-B(T, T+\delta)\left(k+\frac{1}{\delta}\right)\right)^+ |\mathcal{F}_t\right]\]
\[=\left(\delta k+1\right)\mathbb{\tilde{E}}\left[D(t, T)\left(\frac{1}{\delta k+1}-B(T, T+\delta)\right)^+ |\mathcal{F}_t\right]\]
\[=\left(k\delta+1\right)P\left(\frac{1}{\delta k +1}\right)\] Where \(P(\cdot)\) is a put on a bond with strike \(\cdot\).

\section{Forward Price}

\[\mathbb{\tilde{E}}\left[D(t, T)\left(\frac{1}{\delta k+1}-B(T, T+\delta)\right)^+ |\mathcal{F}_t\right]\]
\[=B(t, T)\mathbb{\hat{E}}\left[\left(\frac{1}{\delta k+1}-B(T, T+\delta)\right)^+ |\mathcal{F}_t\right]\]
Where \(\hat{E}\) is the measure induced by \(B(t, T)\).  Under this measure, the dynamics of \(B(T, T+\delta)\) are 
\[d\frac{B(t, T+\delta)}{B(t, T)}\]
\[=\left(\sigma(t, T+\delta)-\sigma(t, T)\right) \frac{B(t, T+\delta)}{B(t, T)}d\tilde{W}_t\]

\section{Vasicek}
Let the risk neutral dynamics of the Vasicek model be denoted 
\[dr=a(\theta(t)-r)dt+\sigma d\tilde{W}_t\]

\subsection{Bond pricing}

Assume that \(\theta(t)\) is piecewise constant between yield curve dates.  By no arbitrage and Feynman-Kac, the zero coupon bond price solve the following PDE:
\[f_t+f_r a(\theta(t)-r)dt+\frac{1}{2}f_{rr} \sigma^2 -rf=0\]
With terminal condition \(f(T, r)=1\).  This is an ``affine'' PDE and has a solution of the form \(e^{-A(t, T)r_t+C(t, T)}\) for deterministic functions \(A\), \(C\).  Substituting this solution, the following ODEs are induced:

\[\begin{cases}
A_t=aA,\,A(T, T)=0\\
C_t=a\theta(t)A+\frac{\sigma^2}{2} A^2,\,C(T, T)=0
\end{cases} 
\]

From here it is clear that \(A(t, T)=\frac{1}{a}\left(1-e^{-a(T-t)}\right)\).  Similarly, 
\[C(t, T)= \sum_j \theta_j \left(e^{-aT}\left(e^{at_j}-e^{at_{j-1}}\right)-(t_j-t_{j-1})\right)-\frac{\sigma^2}{2a^2}\left(A(t, T)-(T-t)+\frac{a}{2}A^2(t, T) \right)\]
Where \(\theta_j\) is the constant parameter between ``yield'' curve dates.  Solving for the yield curve, 
\[Y_{T_i}=-\frac{\mathrm{ln}(B(t, T_i))}{T_i-t}=\frac{A(t, T)r_t-C(t, T)}{T_i-t}\]
This equation can be solved for each \(\theta_j\).  Of course, this assumes that \(a\) and \(\sigma\) are already known.

\subsection{Bond volatility}
In the Vasicek model, \(\sigma(t, T)=\frac{\sigma}{a}(1-e^{-a(T-t)})\)
\[\implies \sigma(t, T+\delta)-\sigma(t, T)=\frac{\sigma}{a}e^{-a(T-t)}\left(1-e^{-a\delta}\right)\]
Hence option pricing on the bond reduces to the Black Scholes formula with \[\sigma_{BS}=\sqrt{\frac{1}{T} \int_0 ^ T \left(\frac{\sigma}{a}e^{-a(T-t)}\left(1-e^{-a\delta}\right)\right)^2 dt}\]
\[\sigma_{BS}=\frac{\sigma}{a}\left(1-e^{-a\delta}\right)\sqrt{\frac{1}{T} \int_0 ^ T e^{-2a(T-t)} dt}\]
\[\sigma_{BS}=\frac{\sigma}{a}\left(1-e^{-a\delta}\right)\sqrt{\frac{1-e^{-2aT}}{2aT}}\]

Note that the volatility depends only on \(a\) and \(\sigma\) and hence these parameters can be calibrated to the cap market.  Once the \(a\) and \(\sigma\) are found, \(\theta\) can be solved for using the equation from the bond pricing.


\subsection{Real World dynamics}

By Girsonav's theorem, 
\[dr=a(b-r)dt+\sigma\left(d\tilde{W}_t+\frac{a(\theta-b)}{\sigma}dt\right)=a(b-r)dt+\sigma dW_t\]
A possible dynamic for the real world process can thus be a constant \(b\). \(r_t\) has the following solution:
\[r_T= e^{-(T-t)}r_t+b\left(1-e^{-(T-t)}\right)+\epsilon_{T-t}\]
Where \(\epsilon_{T-t}\) is white noise.  Solving for \(b\),

\[b=\frac{r_T-e^{-(T-t)}r_t}{1-e^{-(T-t)}}+\hat{\epsilon_{T-t}}\]

Given a time series of observations of \(r_{t_i}\) it is thus trivial to estimate \(b\).

\section{Future Price}

The future price satisfies \[\delta f(t, T; \delta)=\tilde{\mathbb{E}}\left[\frac{1}{B(T, T+\delta)}|\mathcal{F}_t\right]-1\]

\section{Hull White}

The Hull white model uses a time dependent \(\theta(t)\) to fit the current yield curve.  The short rate dynamics are thus \(dr=a\left(\theta(t)-r\right)dt+\sigma dW_t\).  By Hull White, the bond price at some arbitrary future time \(t\) under such a dynamic is as follows:

\[B(t, T)=\frac{B(0, T)}{B(0, t)}e^{A(t, T)F(t)-\frac{\sigma^2}{4a}A^2 (t, T)\left(1-e^{-2at}\right)-A(t, T)r_t}\]
Where \(A(t, T)=\frac{1-e^{-a(T-t)}}{a}\) and \(F(t)=-\frac{\partial \mathrm{log}(B(0, t))}{\partial t}\) is the instantaneous forward rate.

%\[\mathbb{E}\left[r_T|\mathcal{F}_t\right]=e^{-a(T-t)}r_t+F(T)-e^{-a(T-t)}F(t)+\frac{\sigma^2}{2a^2} \left(1-e^{-a(T-t)}+e^{-2aT}-e^{-a(T+t)}\right)\]
\[\mathbb{E}\left[r_T|\mathcal{F}_t\right]=\left(r_t-\phi(t)\right) e^{-a(T-t)}+\phi(T)\]
Where 
\[\phi(t)=F(0, t)+\frac{\sigma^2}{2a^2}\left(1-e^{-at}\right)^2\]
Let this expectation be denoted \(\mu(t, T)\).  

\[\mathbb{V}\left[r_T|\mathcal{F}_t\right]=\frac{\sigma^2}{2a}\left(1-e^{-2a(T-t)}\right)\]
Let this variance be denoted \(\sigma^2_r(t, T)\). 


\subsection{Future Price}

The future price satisfies \[\delta f(t, T; \delta)=\tilde{\mathbb{E}}\left[\frac{1}{B(T, T+\delta)}|\mathcal{F}_t\right]-1\]

In a Hull-White model, 

\[\delta f(t, T; \delta)=\frac{B(0, T)}{B(0, T+\delta)}\tilde{\mathbb{E}}\left[e^{A(T, T+\delta)r_T-A(T, T+\delta)F(T)+\frac{\sigma^2}{4a}A^2 (T, T+\delta)\left(1-e^{-2aT}\right)}|\mathcal{F}_t\right]-1\]

\[=\frac{B(0, T)}{B(0, T+\delta)}e^{A(T, T+\delta)\mu(t, T)+\frac{1}{2}A^2(T, T+\delta)\sigma^2_r(t, T)-A(T, T+\delta)F(T)+\frac{\sigma^2}{4a}A^2 (T, T+\delta)\left(1-e^{-2aT}\right)}-1\]

Note that for some reason I could never get this to quite work.  Instead the following derivation due to 
http://econwpa.repec.org/eps/fin/papers/0503/0503005.pdf is used:

The future price is \[\delta f(t, T; \delta)=\frac{B(t, T)}{B(t, T+\delta)}e^{\gamma(t, T, \delta)}-1\]
For some deterministic function \(\gamma\).  This function is \[\int_t ^ T \sigma_B (s, T+\delta)\left(\sigma_B(s, T+\delta)-\sigma_B(s, T)\right)ds\]

In Hull White, this equals \(\frac{\sigma^2}{a^3}\left(1-e^{-a\delta}\right)\left(1-e^{-a(T-t)}-\frac{e^{-a\delta}}{2}\left(1-e^{-2a(T-t)}\right)\right)\).
\subsection{Adjustment}
There is no analytic expression for the forward-future adjustment without knowing the yield curve.  Since the use of the forward-future adjustment is, in this context, used to construct the yield curve, an approximation must be used.  The continuously compounded forward rate \(F_c (t, T, \delta)=\frac{\mathrm{log}(B(t, T)-\mathrm{log}(B(t, T+\delta))}{\delta}\) has dynamics 
\[dF_c=\frac{\sigma^2(t, T+\delta)-\sigma^2(t, T)}{2\delta} dt + \mathrm{Ito Term}\]
Taking expectations and integrating, 
\[\mathbb{\tilde{E}}[F_c|\mathcal{F}_t]=\frac{\sigma^2}{4\delta a^3}\left(1-e^{-2a(T-t)}-e^{-2a\delta}+e^{-2a(T+\delta-t)}\right)\]

Since the future rate is a martingale, this expectation is the forward-future adjustment assuming both the forward and future rates are continuously compounded. The assumption is that this adjustment approximates the adjustment for simple compounding.


\section{Swap}

An interest rate swap is an instrument in which two parties exchange rates: typically fixed for floating.  This exchange is in arrears, that is, after the time period \(\delta\) of the floating rate has passed.  The payoff the receiver of floating is the following:

\[\sum_{i=0} ^ n \frac{1-B(t_i, t_i+\delta)}{B(t_i, t_i+\delta)\delta}-k\]
Where \(t_0=t\), \(t_n=T\) and \(T\) is the maturity. The price of this swap is
\[\sum_{i=0}^n \mathbb{\tilde{E}}\left[D(t_0, t_i+\delta)\left(\frac{1-B(t_i, t_i+\delta)}{B(t_i, t_i+\delta)\delta}-k\right)|\mathcal{F}_{t_0}\right]\]
By convention, this price is zero at the time of origination.  \(k\) is termed the swap rate, and is solved by setting the equation equal to zero:
\[\sum_{i=0}^n \mathbb{\tilde{E}}\left[D(t_0, t_i+\delta)\left(\frac{1-B(t_i, t_i+\delta)}{B(t_i, t_i+\delta)\delta}-k\right)|\mathcal{F}_{t_0}\right]=0\]
\[\sum_{i=0}^n \mathbb{\tilde{E}}\left[\frac{D(t_0, t_i+\delta)}{B(t_i, t_i+\delta)}|\mathcal{F}_{t_0}\right]=\sum_{i=0}^n \mathbb{\tilde{E}}\left[D(t_0, t_i+\delta)\left(1+k\delta\right)|\mathcal{F}_{t_0}\right]\]

\[\sum_{i=0}^n B(t_0, t_i)=\sum_{i=0}^n B(t_0, t_i+\delta)\left(1+k\delta\right)\]
\[k=\frac{1}{\delta}\left(\frac{\sum_{i=0}^n B(t_0, t_i)}{\sum_{i=0}^n B(t_0, t_i+\delta)}-1\right)\]

\(t_i\) is typically chosen as a multiple of \(\delta\).  In this case, the swap rate can be further simplified:

\[k=\frac{1}{\delta}\left(\frac{1-B(t_0, t_n+\delta)+\sum_{i=0}^n B(t_0, t_i+\delta)}{\sum_{i=0}^n B(t_0, t_i+\delta)}-1\right)\]
\[=\frac{1}{\delta}\left(\frac{1-B(t_0, t_n+\delta)}{\sum_{i=0}^n B(t_0, t_i+\delta)}\right)\]

\subsection{Creating Zero Yield Curve}

Our goal is to create a LIBOR curve (or zero coupon bond curve) out to thirty years.  This will greatly facilitate pricing engines. Unfortunately, LIBOR only goes out one year.  We need to bootstrap this rate from the Swap curve.
\\
\\
Let \(S(t_0, T, \delta)=k\).  Assume we have this rate for every \(T \in t_m+\delta i\) where \(i\in 0,...N\) where \(N=30/ \delta\) and \(t_m\) is the last maturity of the LIBOR curve (typically one year out).  From the definition of \(k\), 

\[S(t_0, t_m, \delta)=\frac{1}{\delta}\left(\frac{1-B(t_0, t_m+\delta)}{\sum_{i=0}^n B(t_0, t_i+\delta)}\right)\]

Note that we have all the values in this expression except for \(B(t_0, t_m+\delta)\).  Solving for this value,

\[S(t_0, t_m, \delta)\delta B(t_0, t_m+\delta)+ S(t_0, t_m, \delta)\delta\sum_{i=0}^{n-1} B(t_0, t_i+\delta)=1-B(t_0, t_m+\delta)\]
\[B(t_0, t_m+\delta)=\frac{1-\delta S(t_0, t_m, \delta)\sum_{i=0}^{n-1} B(t_0, t_i+\delta)}{S(t_0, t_m, \delta)\delta+1}\]


\subsection{American Swaption}

Note that in the Hull-White model that the short rate can be decomposed as \(r_t=\phi(t)+x_t\) where \(\theta(t)=\frac{\phi'(t)}{a}+\phi(t)\) and \(dx_t=-ax_t dt+\sigma dW_t\).  This \(\phi\) is the same as in the computation for the expected value of \(r_t\).  Hence the tree method involves solving the tree in \(x\) and then adding \(\phi(t)\) to the result for pricing and discounting.  The function \(f\) becomes \(\sigma f+\phi(t)=r_t\).





\end{document}
